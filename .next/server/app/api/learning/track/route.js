(()=>{var e={};e.id=5964,e.ids=[5964],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},38722:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>g,serverHooks:()=>y,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>u,POST:()=>l});var n=r(42706),o=r(28203),a=r(45994),c=r(39187),i=r(31983);async function l(e){try{let{documentType:t="general",originalText:r,editedText:s,editType:n="manual",userId:o="default-user",context:a="",confidence:l=1}=await e.json();if(!r||!s)return c.NextResponse.json({error:"originalText and editedText are required"},{status:400});if("function"==typeof i.k.recordCorrection)try{await Promise.resolve(i.k.recordCorrection({originalText:r,correctedText:s,correctionType:n||"manual",context:a,category:t,userId:o,confidence:l}))}catch(e){console.error("learningSystem.recordCorrection failed:",e)}let u="function"==typeof i.k.analyzeTextForImprovements?await Promise.resolve(i.k.analyzeTextForImprovements(s,o,a,t)):null,g="function"==typeof i.k.getUserStats?await Promise.resolve(i.k.getUserStats(o)):null,p="function"==typeof i.k.getWritingSuggestions?await Promise.resolve(i.k.getWritingSuggestions(o,t)):null;return c.NextResponse.json({success:!0,insights:u,userStats:g,writingSuggestions:p,message:"תיקון נרשם בהצלחה במערכת הלמידה המתקדמת"})}catch(e){return console.error("Error in POST /api/learning/track:",e),c.NextResponse.json({error:"שגיאה בשמירת העריכה"},{status:500})}}async function u(e){try{let t=e.nextUrl instanceof URL?e.nextUrl:new URL(e.url),r=t.searchParams.get("userId")||"default-user",s=t.searchParams.get("category")||"",n="function"==typeof i.k.getUserStats?await Promise.resolve(i.k.getUserStats(r)):null,o="function"==typeof i.k.getWritingSuggestions?await Promise.resolve(i.k.getWritingSuggestions(r,s)):null;return c.NextResponse.json({userStats:n,writingSuggestions:o,recentCorrections:[],message:"נתוני הלמידה נטענו בהצלחה"})}catch(e){return console.error("Error fetching learning data:",e),c.NextResponse.json({error:"שגיאה בטעינת נתוני הלמידה"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/learning/track/route",pathname:"/api/learning/track",filename:"route",bundlePath:"app/api/learning/track/route"},resolvedPagePath:"C:\\Users\\liat\\OneDrive - מ.י. לתמלול והקלטה בע מ\\מסמכים\\ktiva-evrit\\app\\api\\learning\\track\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:f,serverHooks:y}=g;function h(){return(0,a.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:f})}},96487:()=>{},78335:()=>{},31983:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});class s{recordCorrection(e){let t={...e,id:this.generateId(),timestamp:new Date};this.corrections.push(t),this.updateUserProfile(t),this.extractPatterns(t)}getLearnedSynonyms(e,t,r,s){let n=this.userProfiles.get(t);return n?n.patterns.filter(t=>t.pattern.includes(e)&&t.context.some(e=>r.includes(e))&&t.category===s).sort((e,t)=>t.accuracy*t.frequency-e.accuracy*e.frequency).map(e=>e.correction):[]}analyzeTextForImprovements(e,t,r,s){let n=this.userProfiles.get(t);if(!n)return{suggestions:[],overallScore:0,categoryScore:0};let o=[];for(let t of n.patterns)e.includes(t.pattern)&&t.category===s&&o.push({original:t.pattern,suggestion:t.correction,confidence:t.accuracy,reason:`למדתי מהתיקונים שלך (${t.frequency} פעמים)`});return{suggestions:o,overallScore:this.calculateTextScore(e,n),categoryScore:this.calculateCategoryScore(e,s,n)}}getWritingSuggestions(e,t){let r=this.userProfiles.get(e);if(!r)return{commonMistakes:[],styleTips:[],categoryInsights:[]};let s=r.corrections.filter(e=>e.category===t),n=new Map;return s.forEach(e=>{let t=`${e.originalText} -> ${e.correctedText}`;n.has(t)?n.get(t).count++:n.set(t,{correction:e.correctedText,count:1})}),{commonMistakes:Array.from(n.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,5).map(([e,t])=>({mistake:e.split(" -> ")[0],correction:t.correction,frequency:t.count})),styleTips:this.generateStyleTips(r,t),categoryInsights:this.generateCategoryInsights(t,r)}}updateUserProfile(e){let t=e.userId,r=this.userProfiles.get(t);r||(r={userId:t,corrections:[],patterns:[],preferences:{formalityLevel:"semi-formal",writingStyle:"business",categoryPreferences:{}},lastUpdated:new Date}),r.corrections.push(e),r.lastUpdated=new Date;let s=e.category;r.preferences.categoryPreferences[s]=(r.preferences.categoryPreferences[s]||0)+1,this.userProfiles.set(t,r)}extractPatterns(e){let t=e.originalText.split(" "),r=e.correctedText.split(" ");for(let s=0;s<t.length;s++)if(t[s]!==r[s]){let n=t[s],o=r[s],a=this.patterns.find(t=>t.pattern===n&&t.category===e.category);a?(a.frequency++,a.accuracy=this.calculateAccuracy(a,o),a.context.includes(e.context)||a.context.push(e.context)):this.patterns.push({pattern:n,correction:o,frequency:1,accuracy:1,context:[e.context],category:e.category})}}calculateAccuracy(e,t){let r=e.frequency;return(e.correction===t?1:0)/r}calculateTextScore(e,t){let r=0,{preferences:s}=t;return"formal"===s.formalityLevel&&(r+=10*["מכובד","בכבוד רב","בהתאם לחוק"].filter(t=>e.includes(t)).length),"academic"===s.writingStyle&&(r+=15*["מחקר","תוצאות","השערה","ניתוח"].filter(t=>e.includes(t)).length),Math.min(100,r)}calculateCategoryScore(e,t,r){if(0===r.corrections.filter(e=>e.category===t).length)return 50;let s=r.patterns.filter(e=>e.category===t);return Math.min(100,s.filter(e=>e.accuracy>.7).length/s.length*100)}generateStyleTips(e,t){let r=[],s=e.corrections.filter(e=>e.category===t),n=this.getCommonMistakes(s);return n.length>0&&r.push(`נסה להימנע מ: ${n.slice(0,3).join(", ")}`),"formal"===e.preferences.formalityLevel&&r.push('השתמש במילים פורמליות יותר כמו "מכובד" במקום "שלום"'),"academic"===e.preferences.writingStyle&&r.push('הוסף יותר מילים אקדמיות כמו "מחקר", "ניתוח", "תוצאות"'),r}generateCategoryInsights(e,t){let r=[];switch(e){case"articles":r.push("במאמרים, השתמש במילים מקצועיות ומדויקות"),r.push('הוסף קישורים בין פסקאות עם מילים כמו "בנוסף", "לפיכך"');break;case"emails":r.push('באימיילים עסקיים, התחל עם "מכובד" וסיים עם "בכבוד"'),r.push("היה קצר וברור - השתמש במילים ישירות");break;case"posts":r.push("בפוסטים ברשתות חברתיות, השתמש במילים מעוררות השראה"),r.push('הוסף קריאות לפעולה עם מילים כמו "הצטרפו", "שתפו"');break;case"scripts":r.push("בתסריטים, השתמש בדיאלוג טבעי ומילים מדוברות"),r.push("הוסף תיאורי פעולה עם מילים דינמיות")}return r}getCommonMistakes(e){let t=new Map;return e.forEach(e=>{let r=e.originalText;t.set(r,(t.get(r)||0)+1)}),Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e])=>e)}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}getUserStats(e){let t=this.userProfiles.get(e);if(!t)return{totalCorrections:0,patternsLearned:0,accuracy:0,improvementTrend:"stable",categoryStats:{}};let r=t.corrections.length,s=t.patterns.length,n=t.patterns.reduce((e,t)=>e+t.accuracy,0)/s||0,o=t.corrections.slice(-10),a=t.corrections.slice(-20,-10),c="stable";if(o.length>0&&a.length>0){let e=o.reduce((e,t)=>e+t.confidence,0)/o.length,t=a.reduce((e,t)=>e+t.confidence,0)/a.length;e>t+.1?c="improving":e<t-.1&&(c="declining")}let i={};return["articles","emails","posts","protocols","scripts","stories","summaries","quotes"].forEach(e=>{let r=t.corrections.filter(t=>t.category===e),s=t.patterns.filter(t=>t.category===e),n=s.reduce((e,t)=>e+t.accuracy,0)/s.length||0;i[e]={corrections:r.length,accuracy:n}}),{totalCorrections:r,patternsLearned:s,accuracy:n,improvementTrend:c,categoryStats:i}}constructor(){this.corrections=[],this.patterns=[],this.userProfiles=new Map}}let n=new s}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,5452],()=>r(38722));module.exports=s})();